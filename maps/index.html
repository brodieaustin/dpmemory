<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Map</title>
    <style>
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0; font-family: sans-serif; font-size: 13px;}
      #map-canvas { width: 80%; height: 100%; float: left; }
      #results {width: 20%; height: 100%; float: left; padding: 6px; box-sizing: border-box; overflow-y: scroll; overflow-x: hidden;}
      #results h2{margin-bottom: 0;}
      #results ul{list-style: none; margin: 0; padding: 0; }
      #results ul li{padding: 6px 0; line-height: 1.5; border-top: 1px solid #eee;}
      .count{color: #888;}
    </style>
</head>
<body>
    <div id="results">
        <h2>Results</h2>
        <ul></ul>
    </div>
    <div id="map-canvas"></div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
   <script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCimpd2qM4HIR8kVRK8yjA-sQ6TpA_Zf_M&sensor=false"></script>
    <script>
        $(document).ready(function(){
                var mapOptions = {
              center: new google.maps.LatLng(42.033889, -87.899722),
              zoom: 13,
              mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            var map = new google.maps.Map(document.getElementById("map-canvas"),
                mapOptions);
                
            var locations = new Array();
            
            //patterns for detetcting lat lng
            var p = /-*[0-9]{2}\.[0-9]+,/;
            var lat, lng;
            var count = 0;
                
                
            $.getJSON('items.json', function(data){
                var total = data.pager.total;
                var records = data.records;
                $.each(records, function(i, record){
                    if (record.locati.length > 0){
                        var loc = record.locati;
                        
                                              
                        if (locations[loc]){
                            locations[loc].push(record.pointer);
                        }
                        else{
                            locations[loc] = [record.pointer];
                        }
                         count++;
                        
                        
                        if (p.test(loc) == false){
                            /*geocoder = new google.maps.Geocoder();
                            geocoder.geocode({ 'address': loc}, function(results, status) {
                                console.log(status);
                                if (status == google.maps.GeocoderStatus.OK) {
                                    var marker = new google.maps.Marker({
                                        map: map,
                                        position: results[0].geometry.location,
                                        title : record.title
                                    });
	                           }
	                       });*/
	                   }
	                   else{
	                        lat = parseFloat(loc.split(',')[0].trim());
	                        lng = parseFloat(loc.split(',')[1].trim());
	                        var marker = new google.maps.Marker({
                                map: map,
                                position: new google.maps.LatLng(lat, lng),
                                title : record.title
                            });
	                   }
	                   
	                   
                    }
                    
                });
                
                var li;
                var ls = 0;
                
                for (var key in locations){
                    li = '<li><div class="location">' + key + '</div><div class="count">' + locations[key].length + ' items</div></li>';
                    $('#results ul').append(li);
                    ls++;
                }
                
                $('#results h2').after('<p>' + count + ' of ' + total + ' with locations.</p><p>' + ls + ' unique locations.');
                
            });
            
        });
    </script>
</body>
</html>
